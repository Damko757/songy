# Songy - Self-Hosted YouTube dowloader, with song metadata!

The objective of this project is to create simple self-hosted YT downloader, that can fetch song metadata automatically.

# Instalation

Clone this repository:
`git clone https://github.com/Damko757/songy`

And start the containers (you need to have [Docker installed](https://github.com/docker/docker-install)):
`sudo docker compose up --build`

# Technicalities

The project is separated into two parts: [WEB/UI](#web) and [API/BE](#api). If needed, only the _api_ can be used (e. g. for custom scripts).

## Shared && .env

### .env options

For sample .env file, check `.sample.env`

| Key      | Description                 |
| -------- | --------------------------- |
| API_PORT | Port, the api will run on   |
| API_URL  | URL for _Web_ to connect to |

| Spotify               |                                                                             |
| --------------------- | --------------------------------------------------------------------------- |
| ENABLE_SPOTIFY        | Defines if Spotify API should be used. If true, SPOTIFY\_\* keys are needed |
| SPOTIFY_CLIENT_ID     | Your ClientId (https://developer.spotify.com/documentation/web-api)         |
| SPOTIFY_CLIENT_SECRET | Your ClientSecret                                                           |

To make Downloading from youtube much easier/faster (and sometimes even for it to work), you need to specify the `POTOKEN` and `VISTOR_DATA`.
You can read more about it here: https://www.npmjs.com/package/@ybd-project/ytdl-core/v/5.1.7#potoken-support
It can be easily (and anonymously) generated via a docker container: `docker run quay.io/invidious/youtube-trusted-session-generator` (https://github.com/iv-org/youtube-trusted-session-generator)

| Youtube      |                                                       |
| ------------ | ----------------------------------------------------- |
| POTOKEN      | Part of special token to bypass bot protection        |
| VISITOR_DATA | Second part of special token to bypass bot protection |

<a id="meta_sources"></a>

## Available metadata source

1. YT music links - using autogenerated description
2. Spotify - first 20 results from YT video title

<a id="api"></a>

## API

> WIP

### /download/{extension}?link={yt-link}

- {extension} - Filetype to download. Currenly only supported is `mp3` (audio only, 320 kbps) and `mp4` (video + audio, highest possible resulution + best possible audio).
- {yt-link} - Youtube link to download (e.g. https://youtu.be/aqz-KE-bpKQ?si=Hd2fpeCaIKBnzn86).

Downloads a stream, that can be directly saved as file.{extension}

### /metadata?link={yt-link}

- {yt-link} - Youtube link to download (e.g. https://youtu.be/aqz-KE-bpKQ?si=Hd2fpeCaIKBnzn86).

Sends found metadata for provided video. Output format can be found [here](https://github.com/Damko757/songy/blob/main/api/src/Metadata/MetadataResponse.ts)

> <a id="web"></a>

## Web

> TODO
> This is web UI for simple usage of the [API](#api)

# Contribution

is welcomed :)

## Development - API

To work on BackEnd part of this project, you need to `cd ./api` folder and run `npm i`. Then you can start dev server by `npm run hot`.

## Development - WEB

To work on FrontEnd part of this project, you need to `cd ./web` folder and run `npm i`. Then you can start dev server by `npm run dev`.
